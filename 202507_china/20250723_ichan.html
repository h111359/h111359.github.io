<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini Gallery — Images + Videos</title>
  <style>
    :root {
      --bg: #0b0c0f; --card: #12141a; --muted:#9aa3af; --text:#e5e7eb; --accent:#60a5fa;
      --radius: 16px; --gap: 14px; --border:#1f2937; --borderHover:#334155;
    }
    * { box-sizing: border-box }
    body {
      margin: 0; background: radial-gradient(1200px 600px at 15% -10%, #0f172a 0%, #0b0c0f 55%) no-repeat fixed, var(--bg);
      color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
    }
    header { max-width: 1000px; margin: 24px auto 8px; padding: 0 16px; display: flex; gap: 12px; align-items: baseline }
    header h1 { margin: 0; font-size: 1.15rem }
    header .meta { color: var(--muted); font-size: .9rem }
    .toolbar { max-width: 1000px; margin: 0 auto 8px; padding: 0 16px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap }
    .search { flex: 1 1 260px; display: flex; background: var(--card); border-radius: 999px; padding: 8px 12px; border: 1px solid var(--border) }
    .search input { flex: 1; background: transparent; border: 0; outline: none; color: var(--text); font-size: .95rem }
    .counts, .hint { color: var(--muted); font-size: .85rem }

    .grid {
      max-width: 1000px; margin: 0 auto 48px; padding: 0 16px;
      display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: var(--gap);
    }
    .card {
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
      overflow: clip; transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .card:hover { border-color: var(--borderHover); box-shadow: 0 6px 24px rgba(0,0,0,.35) }
    .thumb, .poster {
      width: 100%; aspect-ratio: 4/3; display: block; object-fit: cover; background:#0a0c12;
      filter: saturate(1.05); transition: transform .25s ease;
    }
    .card:hover .thumb, .card:hover .poster { transform: scale(1.02) }
    .caption { padding: 10px 12px; font-size: .85rem; color: var(--muted); display: flex; justify-content: space-between; gap: 8px }
    .name { overflow: hidden; text-overflow: ellipsis; white-space: nowrap }
    .caption a { color: var(--accent); text-decoration: none; font-weight: 500; font-size: .85rem }

    /* play badge on videos */
    .video-wrap { position: relative }
    .play {
      position: absolute; inset: 0; display: grid; place-items: center; pointer-events: none;
    }
    .play svg { width: 56px; height: 56px; background: rgba(0,0,0,.45); border-radius: 999px; padding: 10px }

    /* Lightbox */
    .lightbox {
      position: fixed; inset: 0; display: none; place-items: center; background: rgba(0,0,0,.88);
      z-index: 50; padding: 24px; backdrop-filter: blur(2px);
    }
    .lightbox.open { display: grid }
    .lightbox .frame, .lightbox img {
      max-width: min(96vw, 1600px); max-height: 86vh; width: auto; height: auto;
      border: 0; border-radius: 10px; box-shadow: 0 8px 40px rgba(0,0,0,.6); background: #000;
    }
    .close {
      position: fixed; top: 16px; right: 16px; background:#0b1020; color:#d1d5db; border:1px solid #283246;
      border-radius: 999px; padding:8px 12px; cursor:pointer; font-size:.9rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Mini Gallery</h1>
    <div class="meta">3 images + 2 videos (Google Drive preview)</div>
  </header>

  <div class="toolbar">
    <div class="search"><input id="q" type="search" placeholder="Filter by filename…" aria-label="Filter items"></div>
    <div class="counts" id="counts">Loading…</div>
    <div class="hint">Tip: click a card to open in a lightbox. Videos play inline.</div>
  </div>

  <main class="grid" id="grid" aria-live="polite"></main>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Viewer">
    <button class="close" id="closeBtn" title="Close (Esc)">Close</button>
    <!-- content injected here -->
  </div>

  <script>
    // === Utilities for Google Drive ===
    function extractId(previewUrl) {
      const m = String(previewUrl).match(/\/d\/([^/]+)\/preview/);
      return m ? m[1] : null;
    }
    const viewImg = (id) => `https://drive.google.com/uc?export=view&id=${id}`;
    const thumb   = (id, w=1600) => `https://drive.google.com/thumbnail?id=${id}&sz=w${w}`;
    // For videos we’ll embed the preview URL in an <iframe>.
    const iframeSrc = (previewUrl) => previewUrl.replace(/(\?|$)/, (m)=> m.startsWith('?') ? m : '?') + 'autoplay=1';

    // === ITEMS: keep/edit this list only ===
    // First 3 images from your list + 2 videos from your list.
    const items = [
      ["20250723_061843.jpg","https://drive.google.com/file/d/1VvR5d1FTOED24vwO3Mp0SZZujDeH-KLC/preview?authuser=0"],
      ["20250723_062457.jpg","https://drive.google.com/file/d/1Ta-kRWK3o89Ak5y--CyyZdtLX7TYt0NK/preview?authuser=0"],
      ["20250723_065326.jpg","https://drive.google.com/file/d/1_hu0y5NlJzDaZvVifH8G75bwoTv92g1x/preview?authuser=0"],

      // Two videos:
      ["20250723_094339.mp4","https://drive.google.com/file/d/1b0TghvL7oS6CLoDY1--Rvsqrknfi4xyM/preview?authuser=0"],
      ["20250723_095426.mp4","https://drive.google.com/file/d/1_TkiNZrTPAX2fnBsfh8v-W8Nr7XhuQDj/preview?authuser=0"],
    ];

    // === Build normalized list (img or video) ===
    const media = items.map(([name, preview]) => {
      const id = extractId(preview);
      const lower = name.toLowerCase();
      const kind = lower.endsWith('.mp4') ? 'video' : (lower.endsWith('.jpg') || lower.endsWith('.png') || lower.endsWith('.jpeg') ? 'image' : 'other');
      return id ? { name, id, preview, kind } : null;
    }).filter(Boolean);

    const grid = document.getElementById('grid');
    const counts = document.getElementById('counts');
    const q = document.getElementById('q');

    function makeImageCard(item) {
      const card = document.createElement('article');
      card.className = 'card';

      const img = document.createElement('img');
      img.className = 'thumb';
      img.loading = 'lazy';
      img.decoding = 'async';
      img.referrerPolicy = 'no-referrer';
      img.alt = item.name;
      img.src = viewImg(item.id);

      // Fallback to thumbnail if direct view blocks
      let triedThumb = false;
      img.onerror = () => {
        if (!triedThumb) { triedThumb = true; img.src = thumb(item.id, 1600); }
        else {
          img.replaceWith(makeBrokenPreview(item));
        }
      };

      // Lightbox on click
      img.addEventListener('click', (ev) => {
        ev.preventDefault();
        openLightboxImage(viewImg(item.id), item.name);
      });

      const cap = document.createElement('div');
      cap.className = 'caption';
      cap.innerHTML = `<span class="name" title="${item.name}">${item.name}</span>
                       <a href="${item.preview}" target="_blank" rel="noopener">Drive</a>`;

      card.appendChild(img);
      card.appendChild(cap);
      return card;
    }

    function makeVideoCard(item) {
      const card = document.createElement('article');
      card.className = 'card';

      const wrap = document.createElement('div');
      wrap.className = 'video-wrap';

      const poster = document.createElement('img');
      poster.className = 'poster';
      poster.loading = 'lazy';
      poster.decoding = 'async';
      poster.referrerPolicy = 'no-referrer';
      poster.alt = item.name + ' (video)';
      poster.src = thumb(item.id, 1600);
      // If even the thumbnail is blocked:
      poster.onerror = () => poster.replaceWith(makeBrokenPreview(item));

      // Play badge
      const play = document.createElement('div');
      play.className = 'play';
      play.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="#e5e7eb" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10" opacity=".7"></circle>
          <polygon points="10,8 16,12 10,16" fill="#e5e7eb"></polygon>
        </svg>`;

      wrap.appendChild(poster);
      wrap.appendChild(play);

      wrap.addEventListener('click', (ev) => {
        ev.preventDefault();
        openLightboxVideo(item.preview);
      });

      const cap = document.createElement('div');
      cap.className = 'caption';
      cap.innerHTML = `<span class="name" title="${item.name}">${item.name}</span>
                       <a href="${item.preview}" target="_blank" rel="noopener">Drive</a>`;

      card.appendChild(wrap);
      card.appendChild(cap);
      return card;
    }

    function makeBrokenPreview(item) {
      const div = document.createElement('div');
      div.style.cssText = "aspect-ratio:4/3;display:grid;place-items:center;background:#0a0c12;color:#94a3b8;font-size:.9rem;padding:8px;";
      div.innerHTML = `Preview unavailable<br><a href="${item.preview}" target="_blank" rel="noopener" style="color:#60a5fa">Open on Drive</a>`;
      return div;
    }

    function render(list) {
      grid.innerHTML = '';
      for (const item of list) {
        const card = item.kind === 'video' ? makeVideoCard(item) : makeImageCard(item);
        grid.appendChild(card);
      }
      const imgs = list.filter(x => x.kind === 'image').length;
      const vids = list.filter(x => x.kind === 'video').length;
      counts.textContent = `${list.length} items • ${imgs} images • ${vids} videos`;
    }

    q.addEventListener('input', () => {
      const term = q.value.trim().toLowerCase();
      render(term ? media.filter(m => m.name.toLowerCase().includes(term)) : media);
    });

    // === Lightbox ===
    const lightbox = document.getElementById('lightbox');
    const closeBtn = document.getElementById('closeBtn');

    function openLightboxImage(src, alt) {
      lightbox.innerHTML = '';
      lightbox.appendChild(closeBtn);
      const img = document.createElement('img');
      img.alt = alt;
      img.src = src;
      img.loading = 'eager';
      img.decoding = 'sync';
      lightbox.appendChild(img);
      lightbox.classList.add('open');
    }

    function openLightboxVideo(previewUrl) {
      lightbox.innerHTML = '';
      lightbox.appendChild(closeBtn);
      const frame = document.createElement('iframe');
      frame.className = 'frame';
      frame.allow = 'autoplay; fullscreen; picture-in-picture';
      frame.referrerPolicy = 'no-referrer';
      frame.src = iframeSrc(previewUrl); // Google Drive preview player
      lightbox.appendChild(frame);
      lightbox.classList.add('open');
    }

    function closeLightbox() {
      lightbox.classList.remove('open');
      // stop video playback and free memory
      const frame = lightbox.querySelector('iframe');
      if (frame) frame.src = 'about:blank';
      const img = lightbox.querySelector('img');
      if (img) img.removeAttribute('src');
    }

    closeBtn.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeLightbox(); });

    // Init
    render(media);
  </script>
</body>
</html>
